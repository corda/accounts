<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>World Cup Sweepstake</title>
</head>
<script src="https://cdn.jsdelivr.net/npm/lodash@4.17.11/lodash.min.js"></script>
<style>
    .styled-select {
        background: url(http://i62.tinypic.com/15xvbd5.png) no-repeat 96% 0;
        height: 29px;
    }
</style>

<script type="application/javascript">

    async function makeRequest(method, url) {
        return new Promise(function (resolve, reject) {
            var xhr = new XMLHttpRequest();
            xhr.open(method, url);
            xhr.onload = function () {
                if (this.status >= 200 && this.status < 300) {
                    resolve(xhr.response);
                } else {
                    reject({
                        status: this.status,
                        statusText: xhr.statusText
                    });
                }
            };
            xhr.onerror = function () {
                reject({
                    status: this.status,
                    statusText: xhr.statusText
                });
            };
            xhr.send();
        });
    }

    function importPlayers() {

        let playersPromise = makeRequest("GET", `/load-players/`).then(text => JSON.parse(text));

        Promise.all([playersPromise]).then(results => {
            let players = results[0];
            let playersTable = document.createElement("table");

            let playerHeader = document.createElement("th");
            playerHeader.style.display = "inline";
            playerHeader.innerText = "Player name";
            playersTable.appendChild(playerHeader);

            players.forEach(player => {
                let row = document.createElement("tr");
                let playerNameCell = document.createElement("td");
                // let playerHeader = document.createElement("h5");
                playerNameCell.style.display = "inline";
                playerNameCell.innerText = player.playerName;
                // playerNameCell.appendChild(playerHeader);

                row.appendChild(playerNameCell);

                playersTable.appendChild(row);
            });

            document.getElementById('playersHolder').appendChild(playersTable);
        })
    }

    function createAccounts() {
        let accountsPromise = makeRequest("GET", `/create-accounts-issue-teams`).then(text => JSON.parse(text));

        Promise.all([accountsPromise]).then(results => {
            let accountsAndTeams = results[0];

            // let playerTable = document.getElementById('playersHolder');
            let playersTable = document.getElementById('table');
            addColumn(playersTable, "Account ID");
        });
    }

    function importTeams() {

    }

    function addColumn(tblId, columnHeader){
        var tblHeadObj = document.getElementById(tblId).tHead;
        for (var h=0; h<tblHeadObj.rows.length; h++) {
            var newTH = document.createElement('th');
            newTh.innerText = columnHeader;
            tblHeadObj.rows[h].appendChild(newTH);
            newTH.innerHTML = '[th] row:' + h + ', cell: ' + (tblHeadObj.rows[h].cells.length - 1)
        }

        var tblBodyObj = document.getElementById(tblId).tBodies[0];
        for (var i=0; i<tblBodyObj.rows.length; i++) {
            var newCell = tblBodyObj.rows[i].insertCell(-1);
            newCell.innerHTML = '[td] row:' + i + ', cell: ' + (tblBodyObj.rows[i].cells.length - 1)
        }
    }

</script>

<body>


<h1>World Cup Sweepstake</h1>

<div id = "playersHolder">
    <h3>Players</h3>
    <table>
        <tr>
            <td>
                <button onclick="importPlayers()">Import players</button>
                <button onclick="createAccounts()">Create accounts and issue teams</button>
            </td>
        </tr>
    </table>
</div>
</body>
</html>